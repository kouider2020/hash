name: Build LIEF for Termux (Android)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout LIEF
      uses: actions/checkout@v4
      with:
        repository: lief-project/LIEF
        ref: 0.12.3

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install -y \
          cmake ninja-build \
          python3 python3-pip \
          unzip wget

    - name: Download Android NDK
      run: |
        wget https://dl.google.com/android/repository/android-ndk-r26d-linux.zip
        unzip android-ndk-r26d-linux.zip
        echo "NDK=$PWD/android-ndk-r26d" >> $GITHUB_ENV

    - name: Configure LIEF (Android)
      run: |
        mkdir build && cd build

        cmake .. -G Ninja \
          -DCMAKE_BUILD_TYPE=Release \
          -DCMAKE_TOOLCHAIN_FILE=$NDK/build/cmake/android.toolchain.cmake \
          -DANDROID_ABI=arm64-v8a \
          -DANDROID_PLATFORM=android-24 \
          -DLIEF_PYTHON_API=OFF \
          -DLIEF_SHARED_LIB=ON \
          -DLIEF_STATIC_LIB=OFF \
          -DLIEF_ENABLE_JSON=OFF \
          -DLIEF_LOGGING=OFF

    - name: Build
      run: |
        cd build
        ninja

    - name: Package artifacts
      run: |
        mkdir -p artifact/lib
        cp build/libLIEF.so artifact/lib/

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: lief-termux-arm64
        path: artifact
