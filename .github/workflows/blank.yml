name: Build LIEF 0.9.0 ARM64

on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: Enable QEMU (ARM64)
        uses: docker/setup-qemu-action@v3

      - name: Build LIEF 0.9.0 in ARM64 container
        run: |
          docker run --rm --platform linux/arm64 \
            -v $PWD:/work \
            ubuntu:22.04 bash -eux <<'EOF'

          apt update
          apt install -y \
            python3 python3-dev python3-pip \
            build-essential cmake \
            libstdc++6 libssl-dev \
            zlib1g-dev \
            wget tar

          cd /work

          # ---- download LIEF 0.9.0 ----
          wget https://files.pythonhosted.org/packages/source/l/lief/lief-0.9.0.tar.gz
          tar xf lief-0.9.0.tar.gz
          cd lief-0.9.0

          python3 -m pip install --upgrade pip setuptools wheel

          python3 setup.py clean
          python3 setup.py bdist_wheel

          ls -lh dist
          EOF

      - name: Upload wheel
        uses: actions/upload-artifact@v4
        with:
          name: lief-0.9.0-arm64
          path: lief-0.9.0/dist/*.whl
